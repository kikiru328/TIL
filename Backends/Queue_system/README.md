# FastAPI + Redis 기반 대기열 시스템 (Queue System)

## 목적
- 사용자가 몰리는 상황에서 서버의 **최대 동시 접속자 수를 제어**하기 위한 대기열 시스템을 만든다.
- 접속 가능한 사용자는 제한하고, **순번에 따라 입장**을 허용한다.

## 기능 요약
- 유저가 토큰을 발급 받아 대기열에 등록
- Redis로 상태(`waiting`, `active`, `expired`) 관리
- 서버가 대기열을 순차적으로 승격
- 클라이언트는 자신의 상태를 **Polling 또는 WebSocket**으로 확인

## 기술 스택
- **FastAPI**: 백엔드 서버
- **Redis**: 대기열 및 상태 저장
- **uvicorn**: 서버 실행
- **Polling or WebSocket**: 상태 전달 방식 (선택 가능)

## 개발 단계
1. 기본 구조 구성 (FastAPI, Redis)
2. Polling 방식으로 상태 확인 구현
3. 순번 승격 로직 구현
4. WebSocket 방식으로 알림 push (선택 사항)

# 목표

- 대기열 시스템을 구현, `최대 N명` 까지만 동시 접속 가능한 상태를 유지  
- 그 외 사용자는 순번대로 대기. 입장 가능할 때 승격 (`active`)

### 관련 용어 정리

| 용어          | 정의                                                         |
| ----------- | ---------------------------------------------------------- |
| 대기열 (Queue) | 유저가 순서대로 기다리는 선입선출 구조 (FIFO). Redis List로 구현               |
| 토큰 (Token)  | 유저를 구분하는 고유 식별자 (UUID)                                     |
| 상태 (Status) | 각 토큰의 현재 상태 (`waiting`, `active`, `expired`)               |
| Redis       | 빠른 인메모리 DB. 대기열과 상태 저장 용도로 사용                              |
| TTL         | 유효 시간(Time-To-Live). `active` 상태는 일정 시간이 지나면 `expired` 처리됨 |


### Polling vs WebSocket

| 항목    | Polling                         | WebSocket                  |
| ----- | ------------------------------- | -------------------------- |
| 방식    | 일정 주기로 클라이언트가 서버에 `내 상태 뭐야?` 요청 | 서버가 클라이언트에게 실시간으로 상태를 push |
| 장점    | 구현 간단                           | 실시간 알림 가능                  |
| 단점    | 주기적 네트워크 요청 발생                  | 연결 유지 관리 필요                |
| 상황 추천 | 간단한 서비스, 인원 적을 때                | 실시간성이 중요할 때, 사용자 많을 때      |
| 예시    | 대기열, 예약 시스템                     | 채팅, 실시간 알림, 티켓팅            |

### token 발급 API 호출

```bash
# polling
curl -X POST http://localhost:8000/queue/request-token
```


